<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Gemini Chat with Flask</title>
    <style>
        
    </style>
</head>
<body>

    <!--ข้อความขึ้นต้น-->
    <h1>ถาม Gemini ได้เลย!</h1>

    <!--Input ทั้งหมด-->
    <form id="chatForm"> 
        <input type="text" id="promptInput" placeholder="พิมพ์คำถามของคุณ...">
        
        <button type="submit">ส่งคำถาม</button>
    </form>
    
    <hr>

    
    <h2>คำตอบจาก Gemini:</h2>
    <!-- ข้อความที่ใช้ show ข้อมูลจาก AI-->
    <div id="gemini" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; min-height: 50px;">
        <p id="yo">รอการสนทนา...</p>
    </div>

    <script>
        //สร้าง function ที่ใช้ทำ
        async function sendPrompt(event) {
            
            //หยุดการรีโหลดหน้าเว็บเมื่อกดปุ่ม Submit
            event.preventDefault(); 
            
            const promptInput = document.getElementById('promptInput');
            const responseText = document.getElementById('yo');
            
            //ดึงข้อความใน Input
            const userPrompt = promptInput.value; 

            //ถ้าไม่มีข้อความใน Input ให้ส่งข้อความเตือน
            if (!userPrompt) {
                responseText.innerText = 'กรุณากรอกคำถาม';
                return;
            }
            
            responseText.innerText = 'กำลังส่งคำถาม... โปรดรอสักครู่';

            try {
                //บอกตำแหน่งรับข้อมูล และ ส่งข้อมูล
                const response = await fetch('http://127.0.0.1:5001/ask', { 
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify({ userPrompt: userPrompt }) 
                }); 
                
                // ตรวจสอบสถานะการตอบกลับ
                if (!response.ok) {
                    const errorData = await response.json(); 
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                
                // นำคำตอบมาแสดงผล
                responseText.innerText = data.text; 
                promptInput.value = ''; 

            //check error by fetch or server
            } catch (error) {
                console.error('Fetch error:', error);
                responseText.innerText = '❌ เกิดข้อผิดพลาดในการเชื่อมต่อกับ Server หรือ API: ' + error.message;
            }
        }

         document.getElementById('chatForm').addEventListener('submit', sendPrompt);
    </script>
</body>

</html>
